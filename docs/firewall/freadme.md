# ðŸŒ Lab 5: OPNsense Firewall and OpenVPN Deployment
## ðŸŒŸ Project Overview
This project documents the hands-on installation and configuration of OPNsense, an advanced open-source firewall, to segment and secure a virtual network environment. The lab demonstrates core network security concepts, including stateful firewall rule creation, Network Address Translation (NAT) for service accessibility, and the deployment of a Virtual Private Network (VPN) for secure remote access.

**Key Skills Demonstrated:**

- Advanced Firewall Configuration: Installed and configured OPNsense to enforce network boundaries and control traffic flow.


- Network Segmentation: Successfully separated a WAN (Fedora client) and a LAN (Ubuntu server) using the firewall as the border device.


- Port Forwarding (NAT): Configured NAT rules to securely expose internal LAN services to the WAN client.



- VPN Deployment (OpenVPN): Deployed a fully functional OpenVPN Road Warrior server for secure remote access to the internal LAN.



- Rule Prioritization & Log Analysis: Demonstrated the understanding of firewall rule order and utilized live logs to diagnose and resolve traffic blocks.



## ðŸ—ï¸ Lab Architecture
The environment used three Virtual Machines (VMs) connected by different network segments in VMware Workstation to simulate a controlled enterprise setup.

| VM            | Operating System | Network Role | Ports/Services                                                                 |
|---------------|------------------|--------------|----------------------------------------------------------------------------------|
| **Fedora KDE** | Client (WAN)     | Simulates an external client on the WAN/Internet side. Connected via VMware NAT. | Ping (ICMP), Web Browser (HTTP), SSH Client                                      |
| **OPNsense**   | Firewall         | Network Border: Bridges the WAN (NAT) and LAN (LAN Segment) networks. Hosts the OpenVPN server. | HTTP (80), SSH (22), OpenVPN (1194/UDP)                                           |
| **Ubuntu**     | Server (LAN)     | Simulates an internal server. Connected via a dedicated LAN Segment.             | Web Server (80, 25565), SSH Server (22)                                          |

## ðŸ› ï¸ Technical Execution & Inline Evidence
### 1. Initial Hardening and Connectivity Test
The OPNsense firewall was initialized (default credentials: root/opnsense ), and the critical first step of changing the default root password was performed under System > Access > Users > root.



1.1 Custom Firewall Rule for ICMP
By default, all incoming WAN traffic, including ICMP (ping), is blocked. A specific rule was created on the WAN interface to permit ICMP echo requests originating only from the Fedora client's static IP address. This demonstrates the principle of Least Privilege by avoiding the use of the source address "any".


Evidence: The Fedora client successfully pinged the OPNsense WAN address after the rule was applied.

[Insert Screenshot showing Fedora successfully pinging the firewall here]

### 2. Service Exposure using Port Forwarding (NAT)
Port Forwarding rules were configured under Firewall > NAT > Port Forward. This allows the Fedora client to access services hosted on the Ubuntu LAN server via the OPNsense WAN address.


2.1 Forwarding Standard Web Traffic (Port 80)
A NAT rule was set up to redirect incoming TCP port 80 traffic destined for the OPNsense WAN address to the internal Ubuntu Server's IP address. OPNsense automatically created the corresponding WAN firewall rule.


Evidence: The Fedora client successfully accessed the Ubuntu web server default page using the WAN address.

[Insert Screenshot showing Fedora accessing the Ubuntu web server via the OPNsense WAN address here]

2.2 Correcting Rule Order for Custom Port (Port 25565)
A second port forward was created for a "secret website" on TCP port 25565. When access was initially rejected despite the NAT rule, the firewall logs indicated a default "Deny" rule was being hit first. The issue was resolved by changing the order of the WAN rules to prioritize the specific "Allow" rule generated by the NAT entry.


Evidence: The Fedora client successfully accessed the secret web page after rule prioritization.

[Insert Screenshot showing Fedora accessing the secret webpage on 25565 here]

### 3. Log Analysis for DNS Traffic (Step 6)
To configure DNS access, the Firewall > Logs Files > Live View was used to diagnose traffic blocked by OPNsense's default policies.


nslookup: The command nslookup nameserver.lab5.test <WAN-ip-address> revealed that DNS lookups were blocked. A Port Forwarding rule (for DNS, UDP port 53) was created to allow this traffic to reach the Ubuntu server.

[Insert Screenshot of output from nslookup commands here]


dig (Zone Transfer): The command dig @<firewall-ip-address> lab5.test AXFR was run, identifying that this traffic was also blocked and required a separate Port Forwarding rule, demonstrating the different protocols and ports used by DNS queries versus zone transfers.

[Insert Screenshot of output from dig command here]

Evidence: The Port Forwarding page shows all five necessary NAT rules, including the ones for DNS traffic.

[Insert Screenshot showing your port forwarding configuration here]

### 4. OpenVPN Server Deployment (Step 7)
A fully operational OpenVPN Road Warrior server was deployed to provide secure, encrypted access to the LAN network from the Fedora client.



Certificate Creation: An internal Certificate Authority (CA) and a Server Certificate were generated under System > Trust.



User/Client Certificate: A user (fedorakde) and its corresponding client certificate were created for authentication.




Server Configuration: The OpenVPN instance was configured on UDP Port 1194 and set up to push the LAN network ID (192.168.1.0/24) to authenticated clients.



Evidence: The OpenVPN server configuration showing the protocol, port, server network, and local network settings.

[Insert Screenshot showing your OpenVPN configuration here]

4.1 VPN Validation (SSH Access)
After exporting the client configuration and importing it into the Fedora VM, the client successfully connected to the VPN tunnel. This allowed the Fedora client to communicate directly with the Ubuntu server using its private LAN IP address (192.168.1.83), proving the VPN was functioning as a secure virtual bridge.


Evidence: Fedora terminal showing a successful SSH connection to the Ubuntu server's private LAN IP.

[Insert Screenshot showing Fedora SSH'd directly to the Ubuntu's IP address (thanks to the VPN) here]

### 5. Final Configuration
The final state of the OPNsense firewall rules page after all configurations (ICMP, Port Forwarding, and VPN access) were completed.

Evidence: The final WAN firewall rules page showing the various explicit "Allow" rules established during the lab.

[Insert Screenshot showing the final firewall rules here]
